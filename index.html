<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===================================
   CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡πá‡∏ö‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢ (Index)
   ‡πÄ‡∏ô‡πâ‡∏ô‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏£‡∏°‡∏ó‡πà‡∏≤ (#003366) ‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏ó‡∏≠‡∏á (#FFC107)
   =================================== */
:root {
    --college-primary: #003366;
    --college-accent: #FFC107;
}

body {
  font-family: "Kanit", sans-serif;
  background: #F0F4F8; /* Background ‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏Ç‡∏∂‡πâ‡∏ô */
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding-top: 100px; /* üëà ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏õ‡πá‡∏ô 100px */
}
.main-container {
  margin-top: 20px;
  margin-bottom: 40px;
}
/* ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Responsive: ‡πÉ‡∏ä‡πâ max-width ‡πÅ‡∏•‡∏∞ width 95% */
.container {
  max-width: 450px;
  width: 95%;       
  background: #ffffff;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
  text-align: center;
}
h2 { 
    color: var(--college-primary); 
    font-weight: 800; 
    margin-bottom: 20px; 
}

/* Navbar */
.bg-college-primary { background-color: var(--college-primary) !important; }
.Font { 
    font-size: 28px; 
    color: white !important; 
    font-weight: 700; 
    display: flex; 
    align-items: center; 
}
.logo-school { 
    width: 40px; 
    height:auto; 
    margin-right: 10px; 
    margin-left: 0; 
    filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
}
/* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏ï‡∏£‡∏≤‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô Main Container */
.logo-school1 { 
    width: 100px; 
    height:auto; 
    filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
    margin-bottom: 10px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
}


/* Calendar Buttons (‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏î padding/margin ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) */
.year-btn, .month-btn, .day-btn {
  padding: 5px 8px; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏î padding ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
  margin: 3px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏° margin ‡πÄ‡∏õ‡πá‡∏ô 3px ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏ä‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ */
  border: 1px solid #d1d9e6;
  border-radius: 8px;
  background: #fff;
  cursor: pointer;
  transition: .2s;
  font-weight: 500;
}
.month-btn.active { 
    background: var(--college-primary); 
    color: white; 
    border-color: var(--college-primary); 
    font-weight: 700;
}
.month-btn.month-has-event { 
    background: var(--college-accent); 
    border-color: var(--college-accent); 
    font-weight: 700; 
    color: var(--college-primary);
}
.day-btn.active {
  background: var(--college-primary);
  color: white;
  border-color: var(--college-primary);
  font-weight: 700;
}

/* Event Info Box & Button */
#eventInfo {
  margin-top: 20px;
  padding: 15px;
  background: #E6F0FF; 
  border-left:5px solid var(--college-primary);
  border-radius:8px;
  font-size:16px;
  text-align: left;
}
#registerBtn {
  margin-top: 15px;
  background: var(--college-primary);
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  width: 100%;
}
#registerBtn:hover { background: #002B5C; }

/* Sidebar (Offcanvas) */
.offcanvas-header { background-color: var(--college-primary); color: white; }
.offcanvas-title { font-weight: 700; }
.list-group-item { border-left: 5px solid transparent; }
.list-group-item:hover { background-color: #f8f9fa; }
.list-group-item .fw-bold { color: var(--college-accent); }
.nav-link.active { font-weight: 600; color: var(--college-accent) !important; }


/* *** MEDIA QUERY: ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πá‡∏Å‡∏°‡∏≤‡∏Å‡πÜ (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏µ‡∏¢‡∏î) *** */
@media (max-width: 450px) {
    .Font {
        font-size: 22px; /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏Ç‡∏≠‡∏á Navbar */
    }
    .logo-school {
        width: 30px; /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÉ‡∏ô Navbar */
    }
    .container h2 {
        font-size: 1.5rem; /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏ô Main Container */
    }
}

@media (max-width:600px) {
  .container { width:100%; border-radius:0; box-shadow:none; padding: 20px; }
  body { padding-top: 105px; } /* üëà ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏õ‡πá‡∏ô 105px ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
}
</style>

<script src="storage.js"></script>
<script src="auth.js"></script>

</head>

<body>

<nav class="navbar navbar-dark bg-college-primary fixed-top">
  <div class="container-fluid">
    <div class="Font">
      <img src="‡∏ï‡∏£‡∏≤.png" class="logo-school" alt="College Logo">
      ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤
    </div>

    <div class="d-flex align-items-center ms-auto">
      <span id="userText" class="text-white me-2"></span>
      <button id="loginBtn" class="btn btn-warning btn-sm text-dark fw-bold me-2">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
      <button class="navbar-toggler" id="menuBtn" style="display:none;"
        type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasDarkNavbar">
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>

    <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="offcanvasDarkNavbar">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
      </div>

      <div class="offcanvas-body">

        <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">

          <li class="nav-item">
            <a class="nav-link active">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</a>
          </li>

          <ol class="list-group list-group-numbered">

            <li class="list-group-item d-flex justify-content-between align-items-start">
              <div class="ms-2 me-auto">
                <div class="fw-bold">‡∏Ç‡∏≤‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>
                ‡∏Ç‡∏≤‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î : <span id="missCount">0</span>
              </div>
            </li>

            <li class="list-group-item d-flex justify-content-between align-items-start">
              <div class="ms-2 me-auto">
                <div class="fw-bold">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>
                ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î : <span id="joinCount">0</span>
              </div>
            </li>

            <li class="list-group-item d-flex justify-content-between align-items-start">
              <div class="ms-2 me-auto">
                <div class="fw-bold">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°/‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°</div>
                ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏° : <span id="pointCount">0</span>
              </div>
            </li>

            <li class="nav-item mt-2">
              <a class="nav-link" href="tam.html">‡πÅ‡∏•‡∏Å‡πÅ‡∏ï‡πâ‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏¥‡∏ï‡∏û‡∏¥‡∏™‡∏±‡∏¢</a>
            </li>
          </ol>
        
        </ul>

        <div class="mt-4 pt-4 border-top">
          <button id="logoutBtn" class="btn btn-outline-danger w-100" onclick="logout()" style="display:none;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>

      </div>
    </div>
  </div>
</nav>

<div class="container main-container">

<img src="‡∏ï‡∏£‡∏≤.png" class="logo-school1" alt="College Logo">
<h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</h2>

<div class="calendar-header">
  <button class="year-btn" onclick="changeYear(-1)">‚óÄ ‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</button>
  <span id="yearDisplay"></span>
  <button class="year-btn" onclick="changeYear(1)">‡∏õ‡∏µ‡∏´‡∏ô‡πâ‡∏≤ ‚ñ∂</button>
</div>

<div id="monthsContainer"></div>
<div id="daysContainer"></div>

<div id="eventInfo">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>

<button id="registerBtn" style="display:none" onclick="registerEvent()">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>

</div>

<script src="calendar.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

<script>

function updateLoginUI() {
    const studentId = localStorage.getItem("student");

    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const menuBtn = document.getElementById("menuBtn");

    if (studentId) {

        const students = JSON.parse(localStorage.getItem("students") || "[]");
        const stu = students.find(s => s.id === studentId);
        const fullname = stu ? stu.name : studentId;

        document.getElementById("userText").innerText = "üëã " + fullname;

        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
        menuBtn.style.display = "inline-block";

        updateStats();
    } else {
        document.getElementById("userText").innerText = "";
        loginBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
        menuBtn.style.display = "none";
    }
}

/**
 * üí• ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: updateStats()
 * ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡∏´‡∏±‡∏Å‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
 */
function updateStats(){
  const studentId = localStorage.getItem("student");
  const regs = JSON.parse(localStorage.getItem("registrations") || "{}");
  const missed = JSON.parse(localStorage.getItem("missedEvents") || "{}");
  
  // üÜï ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡πÅ‡∏ï‡πâ‡∏°
  const redeemLogs = JSON.parse(localStorage.getItem("redeemLogs") || "[]");
  const subjects = JSON.parse(localStorage.getItem("subjects") || "[]");

  let joinCount = 0;
  Object.keys(regs).forEach(date=>{
    regs[date].forEach(r=>{
      if(r.startsWith(studentId + "_")) joinCount++;
    });
  });

  // 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  let totalEarnedPoints = joinCount * 0.5; 

  // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡∏´‡∏±‡∏Å‡∏≠‡∏≠‡∏Å)
  let redeemedPoints = 0;
  redeemLogs.filter(log => log.studentID === studentId).forEach(log => {
    const subject = subjects.find(s => s.code === log.subjectCode);
    if (subject) {
      redeemedPoints += subject.points;
    }
  });

  // 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ï‡πâ‡∏°‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠
  let finalPoints = totalEarnedPoints - redeemedPoints;
  if (finalPoints < 0) finalPoints = 0; // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πâ‡∏°‡∏ï‡∏¥‡∏î‡∏•‡∏ö

  let missCount = Object.keys(missed).filter(k => k.startsWith(studentId + "_")).length;
  
  // 4. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ï‡πâ‡∏°‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
  localStorage.setItem("points_" + studentId, finalPoints);

  document.getElementById("joinCount").innerText = joinCount;
  document.getElementById("missCount").innerText = missCount;
  document.getElementById("pointCount").innerText = finalPoints.toFixed(1);
}


document.getElementById("loginBtn").onclick = ()=> location.href="login.html";
document.getElementById("logoutBtn").onclick = ()=> { logout(); location.reload(); }

updateLoginUI();

</script>


</body>

</html>


